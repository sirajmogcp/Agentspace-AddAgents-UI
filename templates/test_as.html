<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Registry Service Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .operation-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
        }
        .response-section {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        pre {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }
        .config-section {
            background-color: #e9ecef;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">Agent Registry Service Test</h1>

        <!-- Config Section -->
        <div class="config-section">
            <h3>Configuration</h3>
            <form id="configForm" class="mb-3">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="configFile" class="form-label">Config File</label>
                        <input type="file" class="form-control" id="configFile" accept=".json">
                    </div>
                    <div class="col-md-6">
                        <label for="defaultProjectId" class="form-label">Default Project ID</label>
                        <input type="text" class="form-control" id="defaultProjectId">
                    </div>
                    <div class="col-md-6">
                        <label for="defaultAppId" class="form-label">Default App ID</label>
                        <input type="text" class="form-control" id="defaultAppId">
                    </div>
                </div>
                <button type="submit" class="btn btn-secondary mt-3">Save Config</button>
            </form>
        </div>

        <!-- List Agents Section -->
        <div class="operation-section">
            <h3>List Agents</h3>
            <form id="listAgentsForm" class="mb-3">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="listProjectId" class="form-label">Project ID</label>
                        <input type="text" class="form-control" id="listProjectId" required>
                    </div>
                    <div class="col-md-6">
                        <label for="listAppId" class="form-label">App ID</label>
                        <input type="text" class="form-control" id="listAppId" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary mt-3">List Agents</button>
            </form>
            <div id="listResponse" class="response-section d-none">
                <h4>Response:</h4>
                <pre id="listResponseContent"></pre>
            </div>
        </div>

        <!-- Create Agent Section -->
        <div class="operation-section">
            <h3>Create Agent</h3>
            <form id="createAgentForm" class="mb-3">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="createProjectId" class="form-label">Project ID</label>
                        <input type="text" class="form-control" id="createProjectId" required>
                    </div>
                    <div class="col-md-6">
                        <label for="createAppId" class="form-label">App ID</label>
                        <input type="text" class="form-control" id="createAppId" required>
                    </div>
                    <div class="col-md-6">
                        <label for="displayName" class="form-label">Display Name</label>
                        <input type="text" class="form-control" id="displayName" required>
                    </div>
                    <div class="col-md-6">
                        <label for="description" class="form-label">Description</label>
                        <input type="text" class="form-control" id="description" required>
                    </div>
                    <div class="col-md-6">
                        <label for="toolDescription" class="form-label">Tool Description</label>
                        <input type="text" class="form-control" id="toolDescription" required>
                    </div>
                    <div class="col-md-6">
                        <label for="adkDeploymentId" class="form-label">ADK Deployment ID</label>
                        <input type="text" class="form-control" id="adkDeploymentId" required>
                    </div>
                    <div class="col-md-6">
                        <label for="authId" class="form-label">Auth ID (Optional)</label>
                        <input type="text" class="form-control" id="authId">
                    </div>
                    <div class="col-md-6">
                        <label for="iconUri" class="form-label">Icon URI (Optional)</label>
                        <input type="text" class="form-control" id="iconUri">
                    </div>
                </div>
                <button type="submit" class="btn btn-success mt-3">Create Agent</button>
            </form>
            <div id="createResponse" class="response-section d-none">
                <h4>Response:</h4>
                <pre id="createResponseContent"></pre>
            </div>
        </div>

        <!-- Get Agent Section -->
        <div class="operation-section">
            <h3>Get Agent</h3>
            <form id="getAgentForm" class="mb-3">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="getProjectId" class="form-label">Project ID</label>
                        <input type="text" class="form-control" id="getProjectId" required>
                    </div>
                    <div class="col-md-4">
                        <label for="getAppId" class="form-label">App ID</label>
                        <input type="text" class="form-control" id="getAppId" required>
                    </div>
                    <div class="col-md-4">
                        <label for="getAgentId" class="form-label">Agent ID</label>
                        <input type="text" class="form-control" id="getAgentId" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-info mt-3">Get Agent</button>
            </form>
            <div id="getResponse" class="response-section d-none">
                <h4>Response:</h4>
                <pre id="getResponseContent"></pre>
            </div>
        </div>

        <!-- Get Agent by Name Section -->
        <div class="operation-section">
            <h3>Get Agent by Name</h3>
            <form id="getAgentByNameForm" class="mb-3">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="getByNameProjectId" class="form-label">Project ID</label>
                        <input type="text" class="form-control" id="getByNameProjectId" required>
                    </div>
                    <div class="col-md-4">
                        <label for="getByNameAppId" class="form-label">App ID</label>
                        <input type="text" class="form-control" id="getByNameAppId" required>
                    </div>
                    <div class="col-md-4">
                        <label for="getByNameDisplayName" class="form-label">Display Name</label>
                        <input type="text" class="form-control" id="getByNameDisplayName" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-info mt-3">Get Agent by Name</button>
            </form>
            <div id="getByNameResponse" class="response-section d-none">
                <h4>Response:</h4>
                <pre id="getByNameResponseContent"></pre>
            </div>
        </div>

        <!-- Update Agent Section -->
        <div class="operation-section">
            <h3>Update Agent</h3>
            <form id="updateAgentForm" class="mb-3">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="updateProjectId" class="form-label">Project ID</label>
                        <input type="text" class="form-control" id="updateProjectId" required>
                    </div>
                    <div class="col-md-4">
                        <label for="updateAppId" class="form-label">App ID</label>
                        <input type="text" class="form-control" id="updateAppId" required>
                    </div>
                    <div class="col-md-4">
                        <label for="updateAgentId" class="form-label">Agent ID</label>
                        <input type="text" class="form-control" id="updateAgentId" required>
                    </div>
                    <div class="col-md-6">
                        <label for="updateDisplayName" class="form-label">New Display Name (Optional)</label>
                        <input type="text" class="form-control" id="updateDisplayName">
                    </div>
                    <div class="col-md-6">
                        <label for="updateDescription" class="form-label">New Description (Optional)</label>
                        <input type="text" class="form-control" id="updateDescription">
                    </div>
                    <div class="col-md-6">
                        <label for="updateToolDescription" class="form-label">New Tool Description (Optional)</label>
                        <input type="text" class="form-control" id="updateToolDescription">
                    </div>
                    <div class="col-md-6">
                        <label for="updateAdkDeploymentId" class="form-label">New ADK Deployment ID (Optional)</label>
                        <input type="text" class="form-control" id="updateAdkDeploymentId">
                    </div>
                </div>
                <button type="submit" class="btn btn-warning mt-3">Update Agent</button>
            </form>
            <div id="updateResponse" class="response-section d-none">
                <h4>Response:</h4>
                <pre id="updateResponseContent"></pre>
            </div>
        </div>

        <!-- Delete Agent Section -->
        <div class="operation-section">
            <h3>Delete Agent</h3>
            <form id="deleteAgentForm" class="mb-3">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="deleteProjectId" class="form-label">Project ID</label>
                        <input type="text" class="form-control" id="deleteProjectId" required>
                    </div>
                    <div class="col-md-4">
                        <label for="deleteAppId" class="form-label">App ID</label>
                        <input type="text" class="form-control" id="deleteAppId" required>
                    </div>
                    <div class="col-md-4">
                        <label for="deleteAgentId" class="form-label">Agent ID</label>
                        <input type="text" class="form-control" id="deleteAgentId" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-danger mt-3">Delete Agent</button>
            </form>
            <div id="deleteResponse" class="response-section d-none">
                <h4>Response:</h4>
                <pre id="deleteResponseContent"></pre>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Config handling
        let config = {};

        // Load config from file
        document.getElementById('configFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        config = JSON.parse(e.target.result);
                        // Update default values
                        document.getElementById('defaultProjectId').value = config.project_id || '';
                        document.getElementById('defaultAppId').value = config.app_id || '';
                    } catch (error) {
                        alert('Error loading config file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        });

        // Save config
        document.getElementById('configForm').addEventListener('submit', (e) => {
            e.preventDefault();
            config = {
                project_id: document.getElementById('defaultProjectId').value,
                app_id: document.getElementById('defaultAppId').value
            };
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'config.json';
            a.click();
            URL.revokeObjectURL(url);
        });

        // Helper function to get parameter value
        function getParameterValue(inputId) {
            const value = document.getElementById(inputId).value;
            return value || config[inputId.replace(/^(get|create|update|delete|list|getByName)/, '').toLowerCase()] || '';
        }

        // Helper function to show response
        function showResponse(sectionId, contentId, data) {
            const section = document.getElementById(sectionId);
            const content = document.getElementById(contentId);
            section.classList.remove('d-none');
            content.textContent = JSON.stringify(data, null, 2);
        }

        // List Agents
        document.getElementById('listAgentsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const projectId = getParameterValue('listProjectId');
            const appId = getParameterValue('listAppId');
            
            try {
                const response = await fetch(`/api/as-agents/list-agents?project_id=${projectId}&app_id=${appId}`);
                const data = await response.json();
                showResponse('listResponse', 'listResponseContent', data);
            } catch (error) {
                showResponse('listResponse', 'listResponseContent', { error: error.message });
            }
        });

        // Create Agent
        document.getElementById('createAgentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                project_id: getParameterValue('createProjectId'),
                app_id: getParameterValue('createAppId'),
                display_name: document.getElementById('displayName').value,
                description: document.getElementById('description').value,
                tool_description: document.getElementById('toolDescription').value,
                adk_deployment_id: document.getElementById('adkDeploymentId').value,
                auth_id: document.getElementById('authId').value || null,
                icon_uri: document.getElementById('iconUri').value || null
            };
            
            try {
                const response = await fetch('/api/as-agents/create-agent', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                showResponse('createResponse', 'createResponseContent', result);
            } catch (error) {
                showResponse('createResponse', 'createResponseContent', { error: error.message });
            }
        });

        // Get Agent
        document.getElementById('getAgentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const projectId = getParameterValue('getProjectId');
            const appId = getParameterValue('getAppId');
            const agentId = document.getElementById('getAgentId').value;
            
            try {
                const response = await fetch(`/api/as-agents/get-agent?project_id=${projectId}&app_id=${appId}&agent_id=${agentId}`);
                const data = await response.json();
                showResponse('getResponse', 'getResponseContent', data);
            } catch (error) {
                showResponse('getResponse', 'getResponseContent', { error: error.message });
            }
        });

        // Get Agent by Name
        document.getElementById('getAgentByNameForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const projectId = getParameterValue('getByNameProjectId');
            const appId = getParameterValue('getByNameAppId');
            const displayName = document.getElementById('getByNameDisplayName').value;
            
            try {
                const response = await fetch(`/api/as-agents/get-agent-by-name?project_id=${projectId}&app_id=${appId}&display_name=${displayName}`);
                const data = await response.json();
                showResponse('getByNameResponse', 'getByNameResponseContent', data);
            } catch (error) {
                showResponse('getByNameResponse', 'getByNameResponseContent', { error: error.message });
            }
        });

        // Update Agent
        document.getElementById('updateAgentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                project_id: getParameterValue('updateProjectId'),
                app_id: getParameterValue('updateAppId'),
                agent_id: document.getElementById('updateAgentId').value,
                display_name: document.getElementById('updateDisplayName').value || null,
                description: document.getElementById('updateDescription').value || null,
                tool_description: document.getElementById('updateToolDescription').value || null,
                adk_deployment_id: document.getElementById('updateAdkDeploymentId').value || null
            };
            
            try {
                const response = await fetch('/api/as-agents/update-agent', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                showResponse('updateResponse', 'updateResponseContent', result);
            } catch (error) {
                showResponse('updateResponse', 'updateResponseContent', { error: error.message });
            }
        });

        // Delete Agent
        document.getElementById('deleteAgentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const projectId = getParameterValue('deleteProjectId');
            const appId = getParameterValue('deleteAppId');
            const agentId = document.getElementById('deleteAgentId').value;
            
            if (!confirm(`Are you sure you want to delete agent '${agentId}'?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/as-agents/delete-agent?project_id=${projectId}&app_id=${appId}&agent_id=${agentId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                showResponse('deleteResponse', 'deleteResponseContent', data);
            } catch (error) {
                showResponse('deleteResponse', 'deleteResponseContent', { error: error.message });
            }
        });
    </script>
</body>
</html> 